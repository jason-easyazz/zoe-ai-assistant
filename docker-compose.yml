
services:
  zoe-ollama:
    image: ollama/ollama:latest
    container_name: zoe-ollama
    command: >
      bash -c "ollama pull mistral:latest && ollama serve"
    environment:
      - OLLAMA_HOST=0.0.0.0
    ports:
      - "11434:11434"
    volumes:
      - ./data/ollama:/root/.ollama
    networks:
      - zoe-net
    restart: unless-stopped

  whisper:
    image: onerahmet/openai-whisper-asr-webservice:latest
    container_name: whisper
    ports:
      - "9000:9000"
    networks:
      - zoe-net
    restart: unless-stopped

  coqui-tts:
    image: synesthesiam/mozillatts:latest
    container_name: coqui-tts
    ports:
      - "5002:5002"
    networks:
      - zoe-net
    restart: unless-stopped

  n8n:
    image: n8nio/n8n:latest
    container_name: n8n
    ports:
      - "5678:5678"
    networks:
      - zoe-net
    restart: unless-stopped

  homeassistant:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: homeassistant
    privileged: true
    ports:
      - "8123:8123"
    networks:
      - zoe-net
    restart: unless-stopped

  zoe-core:
    build: ./zoe-core
    container_name: zoe-core
    ports:
      - "${ZOE_CORE_PORT}:8000"
    environment:
      - OLLAMA_HOST=${OLLAMA_HOST}
      - WHISPER_HOST=${WHISPER_HOST}
      - TTS_HOST=${TTS_HOST}
    networks:
      - zoe-net
    depends_on:
      - zoe-ollama

  zoe-ui:
    build: ./zoe-ui
    container_name: zoe-ui
    ports:
      - "${ZOE_UI_PORT}:80"
    volumes:
      - ./zoe-ui/app/templates:/app/templates
      - ./zoe-ui/app/static:/app/static
    networks:
      - zoe-net
    depends_on:
      - zoe-core

networks:
  zoe-net:
    driver: bridge
