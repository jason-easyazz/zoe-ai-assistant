<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Developer Settings</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: linear-gradient(135deg, #fafbfc 0%, #f1f3f6 100%);
            height: 100vh;
            overflow: hidden;
            color: #333;
        }

        /* Header */
        .header {
            height: 56px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            color: #333;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #7B61FF, #5AE0E0);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 4px;
        }

        .nav-link {
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            color: #666;
            transition: all 0.2s;
            font-size: 14px;
        }

        .nav-link.active {
            background: rgba(123, 97, 255, 0.1);
            color: #7B61FF;
        }

        .nav-link:hover:not(.active) {
            background: rgba(0, 0, 0, 0.05);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: #666;
        }

        /* Main Content */
        .content {
            height: calc(100vh - 56px);
            padding: 24px;
            overflow-y: auto;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
        }

        .tab.active {
            background: #7B61FF;
            color: white;
        }

        .tab:hover:not(.active) {
            background: rgba(123, 97, 255, 0.1);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Settings Sections */
        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #333;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-label {
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }

        .setting-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .setting-input {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .setting-input:focus {
            outline: none;
            border-color: #7B61FF;
        }

        .setting-select {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .setting-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .setting-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #7B61FF;
        }

        .setting-textarea {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .setting-textarea:focus {
            outline: none;
            border-color: #7B61FF;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #7B61FF;
            color: white;
        }

        .btn-primary:hover {
            background: #6b51ef;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #22c55e;
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        /* Model Priority List */
        .model-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .model-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .model-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .model-name {
            font-weight: 500;
            color: #333;
        }

        .model-provider {
            font-size: 12px;
            color: #666;
        }

        .model-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .priority-input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            text-align: center;
        }

        /* API Key Display */
        .api-key-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .api-key-value {
            font-family: monospace;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            flex: 1;
        }

        .api-key-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 12px;
        }

        /* Model Routing */
        .model-routing-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .routing-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 0.5fr 1fr 0.5fr 0.5fr 0.5fr 0.5fr 0.5fr;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .model-routing-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .model-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 0.5fr 1fr 0.5fr 0.5fr 0.5fr 0.5fr 0.5fr;
            gap: 12px;
            padding: 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            align-items: center;
            cursor: move;
            transition: all 0.2s;
        }

        .model-row:hover {
            border-color: #7B61FF;
            box-shadow: 0 2px 8px rgba(123, 97, 255, 0.1);
        }

        .model-row.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .model-row.drag-over {
            border-color: #7B61FF;
            background: rgba(123, 97, 255, 0.05);
        }

        .model-select {
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            background: white;
        }

        .provider-select {
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            background: white;
        }

        .task-level-select {
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            background: white;
        }

        .weight-input {
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }

        .token-cap-input {
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }

        .enable-toggle {
            display: flex;
            justify-content: center;
        }

        .test-btn {
            padding: 4px 8px;
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .test-btn:hover {
            background: #16a34a;
        }

        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .drag-handle {
            cursor: move;
            color: #666;
            font-size: 14px;
            margin-right: 8px;
        }

        .model-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
        }

        .status-success {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .status-testing {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 24px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .api-key-section {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .api-key-section h4 {
            margin: 0 0 12px 0;
            color: #333;
            font-size: 14px;
        }

        .api-key-input {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .api-key-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }

        .api-key-input button {
            padding: 8px 16px;
            background: #7B61FF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .api-key-input button:hover {
            background: #6b51ef;
        }

        .api-key-status {
            margin-top: 8px;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .status-connected {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }

        .status-disconnected {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .model-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .model-item:last-child {
            border-bottom: none;
        }

        .model-name {
            font-weight: 500;
            color: #333;
        }

        .model-provider {
            font-size: 12px;
            color: #666;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 50%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="index.html" class="logo">
                <div class="logo-icon">D</div>
                <span>Developer</span>
            </a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">üìä</a>
                <a href="chat.html" class="nav-link">üí¨</a>
                <a href="tasks.html" class="nav-link">üìã</a>
                <a href="tools.html" class="nav-link">üîß</a>
                <a href="monitor.html" class="nav-link">üìà</a>
                <a href="backups.html" class="nav-link">üíæ</a>
                <a href="settings.html" class="nav-link active">‚öôÔ∏è</a>
            </div>
        </div>
        <div class="header-right">
            <span id="currentTime"></span>
        </div>
    </div>

    <div class="content">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('llm')">ü§ñ LLM Config</div>
            <div class="tab" onclick="switchTab('system')">‚öôÔ∏è System</div>
            <div class="tab" onclick="switchTab('security')">üîí Security</div>
            <div class="tab" onclick="switchTab('performance')">üìà Performance</div>
            <div class="tab" onclick="switchTab('backup')">üíæ Backup</div>
            <div class="tab" onclick="switchTab('advanced')">üîß Advanced</div>
        </div>

        <!-- LLM Configuration Tab -->
        <div id="llm-tab" class="tab-content active">
            <div class="settings-section">
                <div class="section-title">Model Configuration</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">Global Daily Token Cap</div>
                        <input type="number" class="setting-input" id="globalTokenCap" value="100000" min="1000" max="10000000">
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Temperature</div>
                        <input type="range" class="setting-input" id="temperature" min="0" max="2" step="0.1" value="0.7">
                        <div id="temperatureValue">0.7</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">API Keys</div>
                        <button class="btn btn-secondary" onclick="openApiKeyManager()">Manage API Keys</button>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Load System Models</div>
                        <button class="btn btn-primary" onclick="loadSystemModels()">Load All Models</button>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <div class="section-title">Model Routing</div>
                <div class="model-routing-container">
                    <div class="routing-header">
                        <span>Model</span>
                        <span>Provider</span>
                        <span>Task Level</span>
                        <span>Weight</span>
                        <span>Daily Cap</span>
                        <span>Default</span>
                        <span>Fallback</span>
                        <span>Enabled</span>
                        <span>Test</span>
                    </div>
                    <div class="model-routing-list" id="modelRoutingList">
                        <!-- Models will be loaded here -->
                    </div>
                    <button class="btn btn-primary" onclick="addModelRow()">+ Add Model</button>
                </div>
            </div>
        </div>

        <!-- System Configuration Tab -->
        <div id="system-tab" class="tab-content">
            <div class="settings-section">
                <div class="section-title">System Settings</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">Environment</div>
                        <select class="setting-select" id="environment">
                            <option value="development">Development</option>
                            <option value="production">Production</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Debug Mode</div>
                        <div class="setting-checkbox">
                            <input type="checkbox" id="debugMode">
                            <label for="debugMode">Enable debug logging</label>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Auto Restart</div>
                        <div class="setting-checkbox">
                            <input type="checkbox" id="autoRestart" checked>
                            <label for="autoRestart">Auto restart on failure</label>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Log Level</div>
                        <select class="setting-select" id="logLevel">
                            <option value="INFO">INFO</option>
                            <option value="DEBUG">DEBUG</option>
                            <option value="WARNING">WARNING</option>
                            <option value="ERROR">ERROR</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Tab -->
        <div id="security-tab" class="tab-content">
            <div class="settings-section">
                <div class="section-title">Security Settings</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">Require Authentication</div>
                        <div class="setting-checkbox">
                            <input type="checkbox" id="enableAuth">
                            <label for="enableAuth">Enable login requirement</label>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">API Rate Limit</div>
                        <div class="setting-description">Requests per minute</div>
                        <input type="number" class="setting-input" id="rateLimit" value="100" min="10" max="1000">
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Encrypt API Keys</div>
                        <div class="setting-checkbox">
                            <input type="checkbox" id="encryptData" checked>
                            <label for="encryptData">Encrypt sensitive data</label>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Data Retention</div>
                        <div class="setting-description">Days to keep logs</div>
                        <input type="number" class="setting-input" id="dataRetention" value="30" min="1" max="365">
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Tab -->
        <div id="performance-tab" class="tab-content">
            <div class="settings-section">
                <div class="section-title">Performance Settings</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">Max Memory (MB)</div>
                        <input type="number" class="setting-input" id="maxMemory" value="2048" min="512" max="8192">
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">CPU Limit (%)</div>
                        <input type="number" class="setting-input" id="cpuLimit" value="80" min="10" max="100">
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Max Concurrent</div>
                        <input type="number" class="setting-input" id="maxConcurrent" value="10" min="1" max="50">
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Enable Caching</div>
                        <div class="setting-checkbox">
                            <input type="checkbox" id="enableCaching" checked>
                            <label for="enableCaching">Cache responses</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup Tab -->
        <div id="backup-tab" class="tab-content">
            <div class="settings-section">
                <div class="section-title">Backup Settings</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">Auto Backup</div>
                        <div class="setting-checkbox">
                            <input type="checkbox" id="autoBackup" checked>
                            <label for="autoBackup">Enable automatic backups</label>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Frequency</div>
                        <select class="setting-select" id="backupFrequency">
                            <option value="daily">Daily</option>
                            <option value="hourly">Hourly</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Keep Backups</div>
                        <input type="number" class="setting-input" id="backupRetention" value="7" min="1" max="30">
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="createBackup()">Create Backup</button>
                <button class="btn btn-secondary" onclick="listBackups()">View Backups</button>
            </div>
        </div>

        <!-- Advanced Tab -->
        <div id="advanced-tab" class="tab-content">
            <div class="settings-section">
                <div class="section-title">Advanced Settings</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">Restart Policy</div>
                        <select class="setting-select" id="restartPolicy">
                            <option value="unless-stopped">Unless Stopped</option>
                            <option value="always">Always</option>
                            <option value="on-failure">On Failure</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Docker Network</div>
                        <input type="text" class="setting-input" id="dockerNetwork" value="zoe-network">
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-danger" onclick="resetSettings()">Reset Settings</button>
                <button class="btn btn-danger" onclick="restartSystem()">Restart System</button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
            <button class="btn btn-secondary" onclick="loadSettings()">üîÑ Reload</button>
            <button class="btn btn-success" onclick="exportSettings()">üì§ Export Config</button>
            <button class="btn btn-secondary" onclick="importSettings()">üì• Import Config</button>
        </div>
    </div>

    <!-- API Key Manager Modal -->
    <div id="apiKeyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">API Key Manager</h3>
                <span class="close" onclick="closeApiKeyManager()">&times;</span>
            </div>
            
            <div class="api-key-section">
                <h4>OpenAI</h4>
                <div class="api-key-input">
                    <input type="password" id="modalOpenaiKey" placeholder="sk-..." value="">
                    <button onclick="saveApiKey('openai')">Save & Load Models</button>
                </div>
                <div id="openaiStatus" class="api-key-status status-disconnected">Not connected</div>
            </div>
            
            <div class="api-key-section">
                <h4>Anthropic</h4>
                <div class="api-key-input">
                    <input type="password" id="modalAnthropicKey" placeholder="sk-ant-..." value="">
                    <button onclick="saveApiKey('anthropic')">Save & Load Models</button>
                </div>
                <div id="anthropicStatus" class="api-key-status status-disconnected">Not connected</div>
            </div>
            
            <div class="api-key-section">
                <h4>Available Models</h4>
                <div class="model-list" id="availableModelsList">
                    <!-- Models will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:8000' 
            : `http://${window.location.hostname}:8000`;

        // Update time
        function updateTime() {
            document.getElementById('currentTime').textContent = 
                new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Temperature slider
        document.getElementById('temperature').addEventListener('input', function() {
            document.getElementById('temperatureValue').textContent = this.value;
        });

        // API key visibility toggle
        function toggleApiKey(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        // RouteLLM + LiteLLM Management
        let modelRoutes = [];
        let availableModels = {
            ollama: [
                { value: 'llama3.2:3b', label: 'Llama 3.2 3B (3.2B)', provider: 'ollama' },
                { value: 'llama3.2:1b', label: 'Llama 3.2 1B (1.2B)', provider: 'ollama' },
                { value: 'qwen2.5:3b', label: 'Qwen 2.5 3B (3.1B)', provider: 'ollama' },
                { value: 'codellama:7b', label: 'CodeLlama 7B (7B)', provider: 'ollama' },
                { value: 'mistral:latest', label: 'Mistral 7B (7.2B)', provider: 'ollama' },
                { value: 'phi3:mini', label: 'Phi-3 Mini (3.8B)', provider: 'ollama' },
                { value: 'gemma:2b', label: 'Gemma 2B (3B)', provider: 'ollama' }
            ],
            openai: [],
            anthropic: []
        };
        let apiKeys = {
            openai: '',
            anthropic: ''
        };

        const taskLevels = [
            { value: 'low', label: 'Low Priority' },
            { value: 'medium', label: 'Medium Priority' },
            { value: 'high', label: 'High Priority' },
            { value: 'critical', label: 'Critical' }
        ];

        // Initialize model routing
        function initializeModelRouting() {
            loadModelRoutes();
            updateModelDropdowns();
        }

        function loadModelRoutes() {
            const container = document.getElementById('modelRoutingList');
            container.innerHTML = modelRoutes.map((route, index) => createModelRow(route, index)).join('');
            makeRowsDraggable();
        }

        function createModelRow(route, index) {
            return `
                <div class="model-row" data-index="${index}">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <select class="model-select" onchange="updateModelRoute(${index}, 'model', this.value)">
                        <option value="">Select Model</option>
                        ${getModelOptions(route.provider)}
                    </select>
                    <select class="provider-select" onchange="updateModelRoute(${index}, 'provider', this.value)">
                        <option value="ollama" ${route.provider === 'ollama' ? 'selected' : ''}>Ollama</option>
                        <option value="openai" ${route.provider === 'openai' ? 'selected' : ''}>OpenAI</option>
                        <option value="anthropic" ${route.provider === 'anthropic' ? 'selected' : ''}>Anthropic</option>
                    </select>
                    <select class="task-level-select" onchange="updateModelRoute(${index}, 'taskLevel', this.value)">
                        ${taskLevels.map(level => 
                            `<option value="${level.value}" ${route.taskLevel === level.value ? 'selected' : ''}>${level.label}</option>`
                        ).join('')}
                    </select>
                    <input type="number" class="weight-input" value="${route.weight || 1}" min="0" max="10" step="0.1" 
                           onchange="updateModelRoute(${index}, 'weight', this.value)">
                    <input type="number" class="token-cap-input" value="${route.dailyCap || 10000}" min="100" max="1000000" 
                           onchange="updateModelRoute(${index}, 'dailyCap', this.value)">
                    <div class="enable-toggle">
                        <input type="radio" name="defaultModel" ${route.isDefault ? 'checked' : ''} 
                               onchange="setDefaultModel(${index})">
                    </div>
                    <div class="enable-toggle">
                        <input type="radio" name="fallbackModel" ${route.isFallback ? 'checked' : ''} 
                               onchange="setFallbackModel(${index})">
                    </div>
                    <div class="enable-toggle">
                        <input type="checkbox" ${route.enabled ? 'checked' : ''} 
                               onchange="updateModelRoute(${index}, 'enabled', this.checked)">
                    </div>
                    <button class="test-btn" onclick="testModel(${index})" ${!route.enabled ? 'disabled' : ''}>
                        Test
                    </button>
                </div>
            `;
        }

        function getModelOptions(provider) {
            const models = availableModels[provider] || [];
            return models.map(model => `<option value="${model.value}">${model.label}</option>`).join('');
        }

        function updateModelRoute(index, field, value) {
            if (!modelRoutes[index]) {
                modelRoutes[index] = { enabled: true, weight: 1, dailyCap: 10000, taskLevel: 'medium' };
            }
            modelRoutes[index][field] = value;
            
            // Update model dropdown if provider changed
            if (field === 'provider') {
                const row = document.querySelector(`[data-index="${index}"]`);
                const modelSelect = row.querySelector('.model-select');
                modelSelect.innerHTML = '<option value="">Select Model</option>' + getModelOptions(value);
                modelRoutes[index].model = '';
            }
            
            // Update test button state
            const testBtn = row.querySelector('.test-btn');
            testBtn.disabled = !modelRoutes[index].enabled;
        }

        function addModelRow() {
            modelRoutes.push({
                model: '',
                provider: 'ollama',
                taskLevel: 'medium',
                weight: 1,
                dailyCap: 10000,
                enabled: true
            });
            loadModelRoutes();
        }

        function makeRowsDraggable() {
            const rows = document.querySelectorAll('.model-row');
            rows.forEach(row => {
                row.draggable = true;
                row.addEventListener('dragstart', handleDragStart);
                row.addEventListener('dragover', handleDragOver);
                row.addEventListener('drop', handleDrop);
                row.addEventListener('dragend', handleDragEnd);
            });
        }

        let draggedIndex = null;

        function handleDragStart(e) {
            draggedIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropIndex = parseInt(e.target.dataset.index);
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                // Reorder array
                const draggedItem = modelRoutes.splice(draggedIndex, 1)[0];
                modelRoutes.splice(dropIndex, 0, draggedItem);
                loadModelRoutes();
            }
            e.target.classList.remove('drag-over');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedIndex = null;
        }

        async function loadModels(provider) {
            const keyInput = document.getElementById(provider + 'Key');
            const apiKey = keyInput.value;
            
            if (!apiKey) {
                alert('Please enter API key first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/developer/load-models`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ provider, apiKey })
                });
                
                if (response.ok) {
                    const models = await response.json();
                    availableModels[provider] = models;
                    updateModelDropdowns();
                    alert(`Loaded ${models.length} models for ${provider}`);
                } else {
                    alert('Failed to load models');
                }
            } catch (error) {
                alert('Error loading models: ' + error.message);
            }
        }

        function setDefaultModel(index) {
            // Clear all other default selections
            modelRoutes.forEach((route, i) => {
                route.isDefault = (i === index);
            });
            loadModelRoutes();
        }

        function setFallbackModel(index) {
            // Clear all other fallback selections
            modelRoutes.forEach((route, i) => {
                route.isFallback = (i === index);
            });
            loadModelRoutes();
        }

        function openApiKeyManager() {
            document.getElementById('apiKeyModal').style.display = 'block';
            loadApiKeyStatus();
            updateAvailableModelsList();
        }

        function closeApiKeyManager() {
            document.getElementById('apiKeyModal').style.display = 'none';
        }

        function loadApiKeyStatus() {
            // Load existing API keys
            document.getElementById('modalOpenaiKey').value = apiKeys.openai;
            document.getElementById('modalAnthropicKey').value = apiKeys.anthropic;
            
            // Update status indicators
            updateApiKeyStatus('openai', apiKeys.openai ? 'connected' : 'disconnected');
            updateApiKeyStatus('anthropic', apiKeys.anthropic ? 'connected' : 'disconnected');
        }

        function updateApiKeyStatus(provider, status) {
            const statusEl = document.getElementById(provider + 'Status');
            statusEl.textContent = status === 'connected' ? 'Connected' : 'Not connected';
            statusEl.className = `api-key-status status-${status}`;
        }

        async function saveApiKey(provider) {
            const keyInput = document.getElementById('modal' + provider.charAt(0).toUpperCase() + provider.slice(1) + 'Key');
            const apiKey = keyInput.value.trim();
            
            if (!apiKey) {
                alert('Please enter an API key');
                return;
            }

            try {
                // Test the API key by loading models
                const response = await fetch(`${API_BASE}/api/developer/load-models`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ provider, apiKey })
                });
                
                if (response.ok) {
                    const models = await response.json();
                    availableModels[provider] = models.map(model => ({
                        ...model,
                        provider: provider
                    }));
                    apiKeys[provider] = apiKey;
                    updateApiKeyStatus(provider, 'connected');
                    updateAvailableModelsList();
                    alert(`Successfully loaded ${models.length} models for ${provider}`);
                } else {
                    alert('Invalid API key or failed to load models');
                    updateApiKeyStatus(provider, 'disconnected');
                }
            } catch (error) {
                alert('Error testing API key: ' + error.message);
                updateApiKeyStatus(provider, 'disconnected');
            }
        }

        function updateAvailableModelsList() {
            const container = document.getElementById('availableModelsList');
            const allModels = [
                ...availableModels.ollama,
                ...availableModels.openai,
                ...availableModels.anthropic
            ];
            
            container.innerHTML = allModels.map(model => `
                <div class="model-item">
                    <div class="model-name">${model.label}</div>
                    <div class="model-provider">${model.provider}</div>
                </div>
            `).join('');
        }

        async function loadSystemModels() {
            try {
                const response = await fetch(`${API_BASE}/api/developer/system-models`);
                if (response.ok) {
                    const systemModels = await response.json();
                    
                    // Add system models to available models
                    if (systemModels.ollama) {
                        availableModels.ollama = systemModels.ollama.map(model => ({
                            ...model,
                            provider: 'ollama'
                        }));
                    }
                    
                    updateAvailableModelsList();
                    alert(`Loaded ${systemModels.ollama?.length || 0} system models`);
                } else {
                    alert('Failed to load system models');
                }
            } catch (error) {
                alert('Error loading system models: ' + error.message);
            }
        }

        async function testModel(index) {
            const route = modelRoutes[index];
            if (!route.model) {
                alert('Please select a model first');
                return;
            }

            const testBtn = document.querySelector(`[data-index="${index}"] .test-btn`);
            testBtn.textContent = 'Testing...';
            testBtn.disabled = true;

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE}/api/developer/test-model`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        model: route.model, 
                        provider: route.provider 
                    })
                });
                
                const endTime = Date.now();
                const latency = endTime - startTime;
                
                if (response.ok) {
                    const result = await response.json();
                    testBtn.textContent = `${latency}ms`;
                    testBtn.classList.add('status-success');
                    alert(`Model test successful!\nLatency: ${latency}ms\nPreview: ${result.preview || 'No preview available'}`);
                } else {
                    testBtn.textContent = 'Error';
                    testBtn.classList.add('status-error');
                    alert('Model test failed');
                }
            } catch (error) {
                testBtn.textContent = 'Error';
                testBtn.classList.add('status-error');
                alert('Error testing model: ' + error.message);
            } finally {
                testBtn.disabled = false;
            }
        }

        // Settings management
        function saveSettings() {
            const settings = {
                llm: {
                    globalTokenCap: parseInt(document.getElementById('globalTokenCap').value),
                    temperature: parseFloat(document.getElementById('temperature').value),
                    apiKeys: apiKeys,
                    modelRoutes: modelRoutes,
                    availableModels: availableModels
                },
                system: {
                    environment: document.getElementById('environment').value,
                    debugMode: document.getElementById('debugMode').checked,
                    logLevel: document.getElementById('logLevel').value,
                    autoRestart: document.getElementById('autoRestart').checked
                },
                security: {
                    enableAuth: document.getElementById('enableAuth').checked,
                    rateLimit: parseInt(document.getElementById('rateLimit').value),
                    encryptData: document.getElementById('encryptData').checked,
                    dataRetention: parseInt(document.getElementById('dataRetention').value)
                },
                performance: {
                    maxMemory: parseInt(document.getElementById('maxMemory').value),
                    cpuLimit: parseInt(document.getElementById('cpuLimit').value),
                    maxConcurrent: parseInt(document.getElementById('maxConcurrent').value),
                    enableCaching: document.getElementById('enableCaching').checked
                },
                backup: {
                    autoBackup: document.getElementById('autoBackup').checked,
                    frequency: document.getElementById('backupFrequency').value,
                    retention: parseInt(document.getElementById('backupRetention').value)
                },
                advanced: {
                    restartPolicy: document.getElementById('restartPolicy').value,
                    dockerNetwork: document.getElementById('dockerNetwork').value
                }
            };

            fetch(`${API_BASE}/api/developer/settings`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                alert('Settings saved successfully!');
            })
            .catch(error => {
                alert('Error saving settings: ' + error.message);
            });
        }

        function loadSettings() {
            fetch(`${API_BASE}/api/developer/settings`)
            .then(response => response.json())
            .then(data => {
                // Load settings into form
                if (data.llm) {
                    document.getElementById('globalTokenCap').value = data.llm.globalTokenCap || 100000;
                    document.getElementById('temperature').value = data.llm.temperature || 0.7;
                    document.getElementById('temperatureValue').textContent = data.llm.temperature || 0.7;
                    
                    if (data.llm.apiKeys) {
                        apiKeys = data.llm.apiKeys;
                    }
                    
                    if (data.llm.availableModels) {
                        availableModels = data.llm.availableModels;
                    }
                    
                    if (data.llm.modelRoutes) {
                        modelRoutes = data.llm.modelRoutes;
                        loadModelRoutes();
                    }
                }
                
                // Load other settings...
                console.log('Settings loaded successfully!');
            })
            .catch(error => {
                console.log('Using default settings');
            });
        }

        function exportSettings() {
            const settings = {
                // Collect all current form values
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'zoe-settings.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const settings = JSON.parse(e.target.result);
                            // Apply settings to form
                            alert('Settings imported successfully!');
                        } catch (error) {
                            alert('Error importing settings: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Action functions
        function createBackup() {
            fetch(`${API_BASE}/api/developer/backup`, { method: 'POST' })
                .then(() => alert('Backup created successfully!'))
                .catch(() => alert('Error creating backup'));
        }

        function listBackups() {
            window.location.href = 'backups.html';
        }

        function restoreBackup() {
            const backupId = prompt('Enter backup ID to restore:');
            if (backupId) {
                fetch(`${API_BASE}/api/developer/restore`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ backupId })
                })
                .then(() => alert('Backup restored successfully!'))
                .catch(() => alert('Error restoring backup'));
            }
        }

        function resetSettings() {
            if (confirm('Reset all settings to defaults? This cannot be undone.')) {
                fetch(`${API_BASE}/api/developer/reset-settings`, { method: 'POST' })
                    .then(() => {
                        alert('Settings reset successfully!');
                        loadSettings();
                    })
                    .catch(() => alert('Error resetting settings'));
            }
        }

        function clearAllData() {
            if (confirm('Clear all data? This will delete all logs, cache, and user data. This cannot be undone.')) {
                fetch(`${API_BASE}/api/developer/clear-data`, { method: 'POST' })
                    .then(() => alert('All data cleared successfully!'))
                    .catch(() => alert('Error clearing data'));
            }
        }

        function restartSystem() {
            if (confirm('Restart the entire system? This will restart all services.')) {
                fetch(`${API_BASE}/api/developer/restart-system`, { method: 'POST' })
                    .then(() => alert('System restart initiated!'))
                    .catch(() => alert('Error restarting system'));
            }
        }

        // Initialize
        loadSettings();
        initializeModelRouting();
    </script>
</body>
</html>

