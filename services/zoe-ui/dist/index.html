<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoe - Personal AI Companion v3.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #7B61FF 0%, #5AE0E0 100%);
            --glass-bg: rgba(255, 255, 255, 0.6);
            --glass-border: rgba(255, 255, 255, 0.4);
            --text-primary: #333;
            --text-secondary: #666;
            --success: #10B981;
            --error: #EF4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: linear-gradient(135deg, #fafbfc 0%, #f1f3f6 100%);
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        /* Orb Mode */
        .orb-mode {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.8s ease;
        }

        .orb-mode.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .fluid-orb {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: var(--primary-gradient);
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(123, 97, 255, 0.3);
            transition: all 0.3s ease;
        }

        .fluid-orb:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 80px rgba(123, 97, 255, 0.4);
        }

        .fluid-layer {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            animation: breathe 3s ease-in-out infinite;
        }

        .fluid-layer:nth-child(2) {
            animation-delay: 1s;
            opacity: 0.6;
        }

        .fluid-layer:nth-child(3) {
            animation-delay: 2s;
            opacity: 0.3;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 1; }
        }

        .fluid-orb.listening .fluid-layer {
            animation: pulse 0.6s ease-in-out infinite;
        }

        .fluid-orb.speaking .fluid-layer {
            animation: vibrate 0.3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        @keyframes vibrate {
            0%, 100% { transform: translateX(0) scale(1); }
            25% { transform: translateX(-2px) scale(1.05); }
            75% { transform: translateX(2px) scale(0.95); }
        }

        .orb-hint {
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 18px;
            font-weight: 300;
            text-align: center;
            opacity: 0.8;
        }

        /* Main Interface */
        .main-interface {
            position: fixed;
            inset: 0;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
            z-index: 100;
        }

        .main-interface.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Navigation */
        .nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 110;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .mini-orb {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .mini-orb:hover {
            transform: scale(1.1);
        }

        .mini-orb .fluid-layer {
            animation: breathe 2s ease-in-out infinite;
        }

        .nav-menu {
            display: flex;
            gap: 5px;
        }

        .nav-item {
            padding: 8px 16px;
            color: var(--text-secondary);
            font-size: 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            background: rgba(123, 97, 255, 0.1);
            color: #7B61FF;
        }

        .nav-item.active {
            background: var(--primary-gradient);
            color: white;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--error);
            transition: background 0.3s ease;
        }

        .status-dot.connected {
            background: var(--success);
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: rgba(123, 97, 255, 0.2);
            color: #7B61FF;
            transform: scale(1.05);
        }

        /* Main Container */
        .main-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 100px 40px 60px;
            min-height: 100vh;
        }

        /* Info Bar */
        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .time-display .current-time {
            font-size: 28px;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .time-display .current-date {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .weather-widget {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 10px 15px;
        }

        .weather-icon {
            font-size: 20px;
        }

        .weather-temp {
            font-size: 20px;
            font-weight: 300;
            color: var(--text-primary);
        }

        /* Greeting */
        .zoe-greeting {
            text-align: center;
            margin-bottom: 30px;
        }

        .zoe-greeting h1 {
            font-size: 32px;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 10px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .zoe-greeting p {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 300;
        }

        /* Chat Container */
        .chat-container {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .chat-container:hover {
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.08);
        }

        .chat-input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.5);
            border: none;
            outline: none;
            font-size: 16px;
            padding: 15px 20px;
            border-radius: 25px;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .chat-input:focus {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 0 2px rgba(123, 97, 255, 0.3);
        }

        .chat-input::placeholder {
            color: var(--text-secondary);
        }

        .voice-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(123, 97, 255, 0.4);
        }

        .voice-btn.active {
            animation: pulse 1s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(123, 97, 255, 0.6);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .quick-action {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 12px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-action:hover {
            background: rgba(123, 97, 255, 0.1);
            transform: translateY(-1px);
        }

        .quick-action span {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 400;
        }

        /* Content Row */
        .content-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .content-card {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .content-card:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: translateY(-2px);
        }

        .content-card h3 {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .task-item, .event-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .task-item:last-child, .event-item:last-child {
            border-bottom: none;
        }

        .task-item:hover, .event-item:hover {
            background: rgba(123, 97, 255, 0.05);
            border-radius: 8px;
            padding-left: 15px;
            padding-right: 15px;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-checkbox.checked {
            background: var(--primary-gradient);
            border-color: #7B61FF;
        }

        .task-checkbox.checked::after {
            content: "✓";
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .task-text {
            flex: 1;
            color: var(--text-primary);
            font-size: 14px;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .event-time {
            color: #7B61FF;
            font-size: 12px;
            font-weight: 500;
        }

        .event-text {
            flex: 1;
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Chat Overlay */
        .chat-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .chat-overlay.active {
            display: flex;
            opacity: 1;
        }

        .chat-window {
            background: var(--glass-bg);
            backdrop-filter: blur(60px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            width: 85%;
            max-width: 450px;
            height: 70%;
            max-height: 600px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUpIn 0.3s ease;
        }

        @keyframes slideUpIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .chat-header {
            padding: 20px 20px 15px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .mini-orb-chat {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary-gradient);
            position: relative;
            overflow: hidden;
        }

        .close-chat-btn {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            font-size: 16px;
        }

        .close-chat-btn:hover {
            background: rgba(255, 0, 0, 0.1);
            color: var(--error);
        }

        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            min-height: 0;
        }

        .chat-input-container {
            padding: 15px 20px 20px;
            border-top: 1px solid var(--glass-border);
            flex-shrink: 0;
        }

        .chat-window .chat-input-group {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 10px 15px;
            margin-bottom: 0;
        }

        .chat-window .chat-input {
            background: transparent;
            border: none;
            padding: 8px 0;
            font-size: 14px;
        }

        .send-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        /* Message Bubbles */
        .message {
            margin-bottom: 12px;
            display: flex;
            gap: 10px;
            animation: fadeIn 0.3s ease-out;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-content {
            background: rgba(255, 255, 255, 0.8);
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 70%;
            font-size: 14px;
            line-height: 1.4;
            color: var(--text-primary);
        }

        .message.user .message-content {
            background: var(--primary-gradient);
            color: white;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 500;
            flex-shrink: 0;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 18px;
            width: fit-content;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Status Indicator */
        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            z-index: 200;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .status-indicator.show {
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 100px 20px 40px;
            }

            .content-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .nav-menu {
                display: none;
            }

            .fluid-orb {
                width: 150px;
                height: 150px;
            }

            .zoe-greeting h1 {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator">Ready</div>

    <!-- Orb Mode -->
    <div class="orb-mode" id="orbMode">
        <div class="fluid-orb" id="fluidOrb" onclick="enterInterface()">
            <div class="fluid-layer"></div>
            <div class="fluid-layer"></div>
            <div class="fluid-layer"></div>
        </div>
        <div class="orb-hint">Touch to interact or press spacebar to talk</div>
    </div>

    <!-- Main Interface -->
    <div class="main-interface" id="mainInterface">
        <!-- Navigation -->
        <div class="nav-bar">
            <div class="nav-left">
                <div class="mini-orb" onclick="exitToOrb()">
                    <div class="fluid-layer"></div>
                </div>
                <div class="nav-menu">
                    <div class="nav-item active" onclick="switchPanel('dashboard')">Dashboard</div>
                    <div class="nav-item" onclick="switchPanel('tasks')">Tasks</div>
                    <div class="nav-item" onclick="switchPanel('calendar')">Calendar</div>
                    <div class="nav-item" onclick="switchPanel('journal')">Journal</div>
                    <div class="nav-item" onclick="switchPanel('shopping')">Shopping</div>
                    <div class="nav-item" onclick="switchPanel('workflows')">Workflows</div>
                </div>
            </div>
            <div class="nav-right">
                <div class="service-status">
                    <div class="status-dot" id="statusCore"></div>
                    <span id="statusText">Core</span>
                </div>
                <button class="close-btn" onclick="switchPanel('settings')" title="Settings">⚙️</button>
            </div>
        </div>

        <div class="main-container">
            <!-- Info Bar -->
            <div class="info-bar">
                <div class="time-display">
                    <div class="current-time" id="currentTime">Loading...</div>
                    <div class="current-date" id="currentDate">Loading...</div>
                </div>
                <div class="weather-widget">
                    <div class="weather-icon" id="weatherIcon">🌤️</div>
                    <div class="weather-temp" id="weatherTemp">23°</div>
                </div>
            </div>

            <!-- Greeting -->
            <div class="zoe-greeting">
                <h1>Hi, I'm Zoe</h1>
                <p>Your personal AI companion. How can I help you today?</p>
            </div>

            <!-- Chat -->
            <div class="chat-container">
                <div class="chat-input-group">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." onclick="openChatWindow()">
                    <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">🎤</button>
                </div>

                <div class="quick-actions">
                    <div class="quick-action" onclick="quickAction('journal')">
                        <span>📝 Journal</span>
                    </div>
                    <div class="quick-action" onclick="quickAction('event')">
                        <span>📅 Event</span>
                    </div>
                    <div class="quick-action" onclick="quickAction('task')">
                        <span>✅ Task</span>
                    </div>
                    <div class="quick-action" onclick="quickAction('shopping')">
                        <span>🛒 Shopping</span>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="content-row">
                <div class="content-card">
                    <h3>Today's Tasks</h3>
                    <div id="taskList">
                        <div class="task-item">
                            <div class="task-checkbox" onclick="toggleTask(this)"></div>
                            <div class="task-text">Review morning schedule</div>
                        </div>
                        <div class="task-item">
                            <div class="task-checkbox" onclick="toggleTask(this)"></div>
                            <div class="task-text">Test Zoe v3.1 integration</div>
                        </div>
                        <div class="task-item">
                            <div class="task-checkbox checked" onclick="toggleTask(this)"></div>
                            <div class="task-text completed">Load AI models</div>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <h3>Upcoming Events</h3>
                    <div id="eventList">
                        <div class="event-item">
                            <div class="event-time">Later</div>
                            <div class="event-text">Voice integration testing</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">Soon</div>
                            <div class="event-text">Backend optimization</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">Next</div>
                            <div class="event-text">Home Assistant setup</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Overlay -->
    <div class="chat-overlay" id="chatOverlay">
        <div class="chat-window">
            <div class="chat-header">
                <div class="chat-title">
                    <div class="mini-orb-chat">
                        <div class="fluid-layer"></div>
                    </div>
                    <span>Chat with Zoe</span>
                </div>
                <button class="close-chat-btn" onclick="closeChatWindow()">×</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message">
                    <div class="message-avatar">Z</div>
                    <div class="message-content">Hello! I'm Zoe, your AI companion. What would you like to talk about?</div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-group">
                    <input type="text" class="chat-input" id="chatInputOverlay" placeholder="Type your message...">
                    <button class="voice-btn" onclick="toggleVoice()">🎤</button>
                    <button class="send-btn" onclick="sendMessage()">→</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let isListening = false;
        let currentMode = 'orb';
        let backendConnected = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Zoe v3.1 Interface Loaded');
            updateTime();
            updateWeather();
            setInterval(updateWeather, 900000); // Update every 15 minutes
            setInterval(updateTime, 1000);
            checkBackendConnection();
            setInterval(checkBackendConnection, 30000);
            
            showStatus('Zoe v3.1 ready');
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (currentMode === 'orb' && e.code === 'Space') {
                    e.preventDefault();
                    toggleVoiceFromOrb();
                }
                if (e.key === 'Escape') {
                    if (document.getElementById('chatOverlay').classList.contains('active')) {
                        closeChatWindow();
                    } else if (currentMode === 'interface') {
                        exitToOrb();
                    }
                }
            });

            // Chat input events
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    openChatWindow();
                }
            });

            document.getElementById('chatInputOverlay').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Close overlay when clicking outside
            document.getElementById('chatOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeChatWindow();
                }
            });
        });

        // Status messages
        function showStatus(message, duration = 3000) {
            const indicator = document.getElementById('statusIndicator');
            indicator.textContent = message;
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, duration);
        }

        // Backend connection check
        async function checkBackendConnection() {
            try {
                const response = await fetch('/health');
                if (response.ok) {
                    const data = await response.json();
                    backendConnected = true;
                    updateServiceStatus(true);
                    console.log('✅ Backend connected:', data.version);
                } else {
                    backendConnected = false;
                    updateServiceStatus(false);
                }
            } catch (error) {
                backendConnected = false;
                updateServiceStatus(false);
                console.log('⚠️ Backend not available (demo mode)');
            }
        }

        function updateServiceStatus(connected) {
            const statusDot = document.getElementById('statusCore');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'Connected';
            } else {
                statusDot.className = 'status-dot';
                statusText.textContent = 'Demo';
            }
        }

        // Mode switching
        function enterInterface() {
            currentMode = 'interface';
            document.getElementById('orbMode').classList.add('hidden');
            document.getElementById('mainInterface').classList.add('active');
            showStatus('Interface activated');
            setTimeout(() => document.getElementById('chatInput').focus(), 300);
        }

        function exitToOrb() {
            currentMode = 'orb';
            document.getElementById('mainInterface').classList.remove('active');
            document.getElementById('orbMode').classList.remove('hidden');
            closeChatWindow();
            showStatus('Returned to orb mode');
        }

        // Navigation
        function switchPanel(panel) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // Only update nav item active state for navigation items, not settings
            if (panel !== 'settings') {
                const clickedItem = event.target;
                if (clickedItem.classList.contains('nav-item')) {
                    clickedItem.classList.add('active');
                }
            }
            
            // Handle special panels
            if (panel === 'settings') {
                showStatus('Settings panel opened');
                // Could open a settings overlay here in the future
                console.log('Settings panel - could implement overlay');
            } else if (panel === 'shopping') {
                showStatus('Shopping list opened');
                // Could open shopping list overlay
                console.log('Shopping list panel');
            } else if (panel === 'workflows') {
                showStatus('Workflows panel opened');
                // Could open n8n workflows interface
                console.log('Workflows panel - n8n integration');
            } else {
                showStatus(`Switched to ${panel}`);
            }
        }

        // Time and Date
        function updateWeather() {
            fetch("http://localhost:8000/api/weather")
                .then(response => response.json())
                .then(data => {
                    document.getElementById("weatherIcon").textContent = data.icon || "🌤️";
                    document.getElementById("weatherTemp").textContent = data.temperature + "°";
                })
                .catch(error => {
                    console.log("Weather API not available, using defaults");
                    document.getElementById("weatherIcon").textContent = "🌤️";
                    document.getElementById("weatherTemp").textContent = "23°";
                });
        }


        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            const dateString = now.toLocaleDateString('en-US', {
                weekday: 'long',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
        }

        // Voice functionality
        function toggleVoice() {
            isListening = !isListening;
            const voiceBtn = document.getElementById('voiceBtn');
            
            if (isListening) {
                voiceBtn.classList.add('active');
                startListening();
            } else {
                voiceBtn.classList.remove('active');
                stopListening();
            }
        }

        function toggleVoiceFromOrb() {
            isListening = !isListening;
            const fluidOrb = document.getElementById('fluidOrb');
            
            if (isListening) {
                fluidOrb.className = 'fluid-orb listening';
                startListening();
                showStatus('Listening...');
            } else {
                fluidOrb.className = 'fluid-orb';
                stopListening();
                showStatus('Stopped listening');
            }
        }

        async function startListening() {
            if (backendConnected) {
                try {
                    await fetch('/api/voice/start', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    showStatus('Listening for voice input...');
                } catch (error) {
                    showStatus('Voice recording started (demo mode)');
                }
            } else {
                showStatus('Voice recording started (demo mode)');
            }
        }

        async function stopListening() {
            if (backendConnected) {
                try {
                    const response = await fetch('/api/voice/stop', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        if (data.transcription) {
                            handleVoiceInput(data.transcription);
                        }
                    }
                } catch (error) {
                    demoVoiceInput();
                }
            } else {
                demoVoiceInput();
            }
        }

        function demoVoiceInput() {
            setTimeout(() => {
                const demoInputs = [
                    "Hello Zoe, how are you today?",
                    "What's the weather like?",
                    "Add a new task for me",
                    "Tell me about my schedule"
                ];
                const randomInput = demoInputs[Math.floor(Math.random() * demoInputs.length)];
                handleVoiceInput(randomInput);
            }, 1000);
        }

        function handleVoiceInput(text) {
            if (currentMode === 'orb') {
                document.getElementById('chatInput').value = text;
                enterInterface();
                setTimeout(() => openChatWindow(), 500);
            } else {
                document.getElementById('chatInputOverlay').value = text;
                if (document.getElementById('chatOverlay').classList.contains('active')) {
                    sendMessage();
                } else {
                    openChatWindow();
                }
            }
            showStatus('Voice input received');
        }

        // Chat functionality
        function openChatWindow() {
            document.getElementById('chatOverlay').classList.add('active');
            setTimeout(() => {
                document.getElementById('chatInputOverlay').focus();
            }, 300);
            showStatus('Chat opened');
        }

        function closeChatWindow() {
            document.getElementById('chatOverlay').classList.remove('active');
            showStatus('Chat closed');
        }

        async function sendMessage() {
            const input = document.getElementById('chatInputOverlay');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            if (backendConnected) {
                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: message,
                            user_id: 'default'
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        hideTypingIndicator();
                        addMessage(data.response, 'assistant');
                        
                        // Handle any extracted entities
                        if (data.entities) {
                            handleExtractedEntities(data.entities);
                        }
                    } else {
                        throw new Error('Network response was not ok');
                    }
                } catch (error) {
                    console.error('Chat error:', error);
                    hideTypingIndicator();
                    addMessage('I\'m having trouble connecting right now, but I\'m here in demo mode!', 'assistant');
                }
            } else {
                // Demo mode
                setTimeout(() => {
                    hideTypingIndicator();
                    const response = generateDemoResponse(message);
                    addMessage(response, 'assistant');
                }, 1500);
            }
        }

        function generateDemoResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('weather')) {
                return "I can see it's currently 23° and sunny! Once I'm connected to a weather service, I can give you detailed forecasts.";
            } else if (lowerMessage.includes('task')) {
                return "I'd love to help you manage tasks! You can see some sample tasks on the dashboard. Once connected, I can create and update them for you.";
            } else if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return "Hello! Welcome to Zoe v3.1! I'm your AI companion and I'm excited to show you this beautiful new interface.";
            } else if (lowerMessage.includes('journal')) {
                return "Journaling is a wonderful way to reflect! Once my backend is connected, I can help you create journal entries and track your mood over time.";
            }
            
            const responses = [
                "That's interesting! I'm currently running in demo mode, but I can see your message clearly.",
                "I'd love to help with that! Once my backend services are connected, I'll have access to all my smart features.",
                "Great question! I'm Zoe, your personal AI companion. This interface showcases what we can do together.",
                "This v3.1 interface is beautiful, isn't it? Fluid animations, glass morphic design, and optimized for touch!",
                "I'm excited to be fully connected soon! Then I can help with tasks, weather, journaling, and so much more."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'Y' : 'Z';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message';
            typingDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'Z';
            
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(indicator);
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Handle extracted entities from AI
        function handleExtractedEntities(entities) {
            if (entities.tasks && entities.tasks.length > 0) {
                entities.tasks.forEach(task => {
                    addTaskToList(task.title);
                });
                showStatus(`Added ${entities.tasks.length} new task(s)`);
            }
            
            if (entities.events && entities.events.length > 0) {
                entities.events.forEach(event => {
                    addEventToList(event.title, event.time);
                });
                showStatus(`Added ${entities.events.length} new event(s)`);
            }
        }

        // Task management
        function toggleTask(checkbox) {
            const taskText = checkbox.nextElementSibling;
            
            checkbox.classList.toggle('checked');
            taskText.classList.toggle('completed');
            
            const isCompleted = checkbox.classList.contains('checked');
            const taskContent = taskText.textContent;
            
            showStatus(`Task ${isCompleted ? 'completed' : 'unchecked'}`);
            
            if (backendConnected) {
                updateTaskInBackend(taskContent, isCompleted);
            }
        }

        async function updateTaskInBackend(taskTitle, completed) {
            try {
                await fetch('/api/tasks/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: taskTitle,
                        completed: completed
                    })
                });
            } catch (error) {
                console.log('Task update not synced');
            }
        }

        function addTaskToList(title) {
            const taskList = document.getElementById('taskList');
            const taskItem = document.createElement('div');
            taskItem.className = 'task-item';
            
            taskItem.innerHTML = `
                <div class="task-checkbox" onclick="toggleTask(this)"></div>
                <div class="task-text">${title}</div>
            `;
            
            taskList.appendChild(taskItem);
        }

        function addEventToList(title, time) {
            const eventList = document.getElementById('eventList');
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            
            eventItem.innerHTML = `
                <div class="event-time">${time || 'Later'}</div>
                <div class="event-text">${title}</div>
            `;
            
            eventList.appendChild(eventItem);
        }

        // Quick actions
        function quickAction(action) {
            switch(action) {
                case 'journal':
                    openChatWindow();
                    setTimeout(() => {
                        addMessage('Let\'s create a journal entry! What\'s on your mind today?', 'assistant');
                    }, 500);
                    break;
                    
                case 'event':
                    openChatWindow();
                    setTimeout(() => {
                        document.getElementById('chatInputOverlay').value = 'Schedule an event: ';
                        document.getElementById('chatInputOverlay').focus();
                    }, 300);
                    break;
                    
                case 'task':
                    openChatWindow();
                    setTimeout(() => {
                        document.getElementById('chatInputOverlay').value = 'Create a new task: ';
                        document.getElementById('chatInputOverlay').focus();
                    }, 300);
                    break;

                case 'shopping':
                    openChatWindow();
                    setTimeout(() => {
                        document.getElementById('chatInputOverlay').value = 'Add to shopping list: ';
                        document.getElementById('chatInputOverlay').focus();
                    }, 300);
                    break;
            }
            showStatus(`${action} action activated`);
        }

        // Load dashboard data from backend
        async function loadDashboardData() {
            if (!backendConnected) return;
            
            try {
                // Load tasks
                const tasksResponse = await fetch('/api/tasks/today');
                if (tasksResponse.ok) {
                    const tasks = await tasksResponse.json();
                    const taskList = document.getElementById('taskList');
                    taskList.innerHTML = '';
                    
                    tasks.forEach(task => {
                        const taskItem = document.createElement('div');
                        taskItem.className = 'task-item';
                        taskItem.innerHTML = `
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(this)"></div>
                            <div class="task-text ${task.completed ? 'completed' : ''}">${task.title}</div>
                        `;
                        taskList.appendChild(taskItem);
                    });
                }

                // Load events
                const eventsResponse = await fetch('/api/events/upcoming');
                if (eventsResponse.ok) {
                    const events = await eventsResponse.json();
                    const eventList = document.getElementById('eventList');
                    eventList.innerHTML = '';
                    
                    events.forEach(event => {
                        const eventTime = new Date(event.start_time).toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        });
                        
                        const eventItem = document.createElement('div');
                        eventItem.className = 'event-item';
                        eventItem.innerHTML = `
                            <div class="event-time">${eventTime}</div>
                            <div class="event-text">${event.title}</div>
                        `;
                        eventList.appendChild(eventItem);
                    });
                }
            } catch (error) {
                console.log('Dashboard data not available');
            }
        }

        // Load dashboard data after connection check
        setTimeout(loadDashboardData, 3000);

        // Console welcome message
        console.log(`
🌟 Zoe v3.1 Interface Loaded Successfully!

✨ Features Active:
   • Fluid orb animations with interactive states
   • Glass morphic design with backdrop blur
   • Touch-optimized for Raspberry Pi 5
   • Real-time clock display
   • Interactive chat with AI backend
   • Task and event management
   • Voice input (spacebar in orb mode)
   • Backend integration with graceful fallbacks

🎯 Status: ${backendConnected ? 'Connected to backend' : 'Demo mode'}

💡 Try:
   • Click the orb to enter interface
   • Press spacebar for voice input in orb mode
   • Type messages in chat
   • Toggle tasks and try quick actions
   • Use ESC to return to orb mode

🔗 API Endpoints:
   • /health - Service health
   • /api/chat - AI chat
   • /api/voice/start & /api/voice/stop - Voice services
   • /api/tasks/today & /api/tasks/update - Tasks
   • /api/events/upcoming - Events

Built for Zoe v3.1 on Raspberry Pi 5! 🚀
        `);
    </script>
</body>
</html>